{% extends 'base.html' %}

{% block content %}

<div class="col-md-10">
    <table class="table table-striped">
        <h4 class="text-center"> (当前位置: 主页) </h4>
        <h3 class="text-center">尚未审核</h3>
        <thead>
            <tr>
            <th>名称</th>
            <th>城市</th>
            <th>邮编</th>
            <th></th>
            </tr>
        </thead>
        <tbody>
            <tr>
            <td>Tanmay</td>
            <td>Bangalore</td>
            <td>560001</td>
            <td><button type="button" class="btn btn-default">修改</button></td>
            </tr>
        </tbody>
        </table>
</div>

<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <h2 class="text-center">修改密码</h2>
                    <div class="form-group">
                        <label for="username">用户名</label>
                        <input type="text" name="username" disabled value="{{ request.user.username }}" id="username"
                               class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="old_password">原密码</label>
                        <input type="password" name="old_password" id="old_password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="new_password">新密码</label>
                        <input type="password" name="new_password" id="new_password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="confirm_password">确认密码</label>
                        <input type="password" name="confirm_password" id="confirm_password" class="form-control">
                    </div>
                    <input type="button" id="b1" class="btn btn-primary" value="提交">
                    <button type="button" class="btn btn-default " data-dismiss="modal">取消</button>
                    <span style="color: red" id="error"></span>
                    <br>
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $('#b1').on('click', function () {
        $.ajax({
            url: '/set_password/',
            type: 'post',
            data: {
                'old_password': $('#old_password').val(),
                'new_password': $('#new_password').val(),
                'confirm_password': $('#confirm_password').val(),
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (data) {
                if (data.code == 1000) {
                    window.location.href = data.url
                } else {
                    $('#error').text(data.msg)
                }
            }
        })
    })
</script>

{% endblock %}